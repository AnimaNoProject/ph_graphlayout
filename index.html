<!DOCTYPE html>
<header>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3-queue/3.0.4/d3-queue.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</header>

<body>
    <div>
        <div class="graph">
            <canvas id="graph" width="1200" height="900"></canvas>
        </div>
        <div class="barcode">
            <input class="slider" type="range" min="1" max="100" value="50" id="slider">
            <svg class="barchart" id="barcode" width="200" height="500"></svg>
        </div>
    </div>
</body>

<script>
    const canvas = document.querySelector("#graph"),
        context = canvas.getContext("2d"),
        width = canvas.width,
        height = canvas.height;

    const simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function (d) {
            return d.id;
        }))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height / 2));

    d3.json("miserables.json", function(error, graph) {
        if (error) throw error;

        simulation
            .nodes(graph.nodes)
            .on("tick", ticked);

        simulation.force("link")
            .links(graph.links);

        function ticked() {
            context.clearRect(0, 0, width, height);

            context.beginPath();
            graph.links.forEach(drawLink);
            context.strokeStyle = "#aaa";
            context.stroke();

            context.beginPath();
            graph.nodes.forEach(drawNode);
            context.fill();
            context.strokeStyle = "#fff";
            context.stroke();
        }
    });

    function drawLink(d) {
        context.moveTo(d.source.x, d.source.y);
        context.lineTo(d.target.x, d.target.y);
    }

    function drawNode(d) {
        context.moveTo(d.x + 3, d.y);
        context.arc(d.x, d.y, 3, 0, 2 * Math.PI);
    }

    // barchart
    const data = [{"salesperson": "Bob", "sales": 33}, {"salesperson": "Robin", "sales": 12}, {
        "salesperson": "Anne",
        "sales": 41
    }, {"salesperson": "Mark", "sales": 16}, {"salesperson": "Joe", "sales": 3}, {
        "salesperson": "Eve",
        "sales": 38
    }, {"salesperson": "Karen", "sales": 21}, {"salesperson": "Kirsty", "sales": 25}, {
        "salesperson": "Chris",
        "sales": 30
    }, {"salesperson": "Lisa", "sales": 47}, {"salesperson": "Tom", "sales": 5}, {
        "salesperson": "Stacy",
        "sales": 20
    }, {"salesperson": "Charles", "sales": 5}, {"salesperson": "Mary", "sales": 10}];

    
    // set the dimensions and margins of the graph
    const margin = {top: 20, right: 20, bottom: 30, left: 40},
        bar_width = 200 - margin.left - margin.right,
        bar_height = 900 - margin.top - margin.bottom;

    // set the ranges
    const y = d3.scaleBand()
        .range([bar_height, 0])
        .padding(0.1);

    const x = d3.scaleLinear()
        .range([0, bar_width]);

    const svg = d3.select("#barcode");
    svg.append("g").attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

    // format the data
    data.forEach(function(d) {
        d.sales = +d.sales;
    });

    data.sort(function(a, b) {
        return b.sales - a.sales;
    });

    // Scale the range of the data in the domains
    x.domain([0, d3.max(data, function(d){ return d.sales; })])
    y.domain(data.map(function(d) { return d.salesperson; }));

    // append the rectangles for the bar chart
    svg.selectAll(".bar")
        .data(data)
        .enter().append("rect")
        .attr("class", "bar")
        //.attr("x", function(d) { return x(d.sales); })
        .attr("width", function(d) {return x(d.sales); } )
        .attr("y", function(d) { return y(d.salesperson); })
        .attr("height", y.bandwidth())

    svg.select(".bar").order();
</script>

